<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ”‹ æ–°èƒ½æºåŸºé‡‘æ“ä½œå»ºè®®ï¼ˆè‡ªåŠ¨çœŸå®æ•°æ®ç‰ˆï¼‰</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
      background: #f8fafc;
      color: #2d3748;
      padding: 20px;
      line-height: 1.5;
    }
    h1 {
      text-align: center;
      color: #0d6efd;
      margin-bottom: 24px;
      font-size: 1.6em;
      font-weight: 700;
    }

    .top-row {
      display: flex;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto 20px;
      flex-wrap: wrap;
    }
    .bottom-row {
      display: flex;
      justify-content: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .panel {
      flex: 1;
      min-width: 280px;
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.05);
      padding: 20px;
    }
    .panel-title {
      font-size: 1.05em;
      font-weight: 700;
      color: #1a73e8;
      margin-bottom: 16px;
      padding-bottom: 10px;
      border-bottom: 2px solid #edf2f7;
    }

    .data-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 9px 0;
      font-size: 0.98em;
    }
    .data-label {
      font-weight: 600;
      color: #4a5568;
    }
    .data-value {
      font-weight: 700;
      min-width: 75px;
      text-align: right;
    }
    .data-tip {
      margin-left: 8px;
      font-size: 0.88em;
      color: #718096;
    }
    .tip-error { color: #dc2626; font-weight: bold; }

    .logic-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .logic-label-inline {
      font-weight: 600;
      color: #4a5568;
      min-width: 100px;
      white-space: nowrap;
    }
    .logic-status-inline {
      font-size: 0.98em;
      flex: 1;
      word-break: break-word;
      line-height: 1.4;
      color: #a0aec0;
    }

    .advice-panel {
      width: calc((100% - 40px) / 3);
      max-width: 400px;
      background: #fff9db;
      border: 2px solid #ffedd5;
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(255,165,0,0.1);
    }
    .advice-title {
      font-size: 1.15em;
      font-weight: 700;
      color: #ea580c;
      margin-bottom: 16px;
    }
    .final-advice {
      font-size: 1.2em;
      font-weight: 700;
      padding: 14px 16px;
      border-radius: 12px;
      line-height: 1.4;
      background: #fef3c7;
      color: #92400e;
    }

    .update-time {
      text-align: center;
      margin-top: 24px;
      color: #718096;
      font-size: 0.9em;
    }

    @media (max-width: 900px) {
      .top-row { flex-direction: column; }
      .advice-panel { width: 100%; max-width: 500px; }
    }
  </style>
</head>
<body>
  <h1>ğŸ”‹ æ–°èƒ½æºåŸºé‡‘æ“ä½œå»ºè®®ï¼ˆè‡ªåŠ¨çœŸå®æ•°æ®ç‰ˆï¼‰</h1>

  <div class="top-row">
    <div class="panel">
      <div class="panel-title">ğŸ“Š å®æ—¶æ•°æ®</div>
      <div class="data-item">
        <span class="data-label">åŸºé‡‘ï¼ˆ001158ï¼‰å‡€å€¼ï¼š</span>
        <span class="data-value" id="fund-value">â€”</span>
        <span class="data-tip" id="fund-tip">â€”</span>
      </div>
      <div class="data-item">
        <span class="data-label">åˆ›ä¸šæ¿æŒ‡ï¼ˆ399006ï¼‰ï¼š</span>
        <span class="data-value" id="cyb-value">â€”</span>
        <span class="data-tip" id="cyb-tip">â€”</span>
      </div>
      <div class="data-item">
        <span class="data-label">æ–°èƒ½æºæŒ‡æ•°ï¼ˆ399808ï¼‰ï¼š</span>
        <span class="data-value" id="ne-value">â€”</span>
        <span class="data-tip" id="ne-tip">â€”</span>
      </div>
      <div class="data-item">
        <span class="data-label">æˆäº¤é¢ï¼ˆäº¿å…ƒï¼‰ï¼š</span>
        <span class="data-value" id="ne-volume">â€”</span>
        <span class="data-tip" id="volume-tip">â€”</span>
      </div>
    </div>

    <div class="panel">
      <div class="panel-title">ğŸ§  ä½¿ç”¨è¯´æ˜</div>
      <div style="font-size:0.95em;color:#4a5568;line-height:1.6;">
        <p>âœ… æœ¬ç¨‹åºä½¿ç”¨<strong>çœŸå®å…¬å¼€æ¥å£</strong>è‡ªåŠ¨è·å–æ•°æ®ã€‚</p>
        <p>âš ï¸ è‹¥æ˜¾ç¤ºâ€œåŠ è½½å¤±è´¥â€ï¼Œè¯·å°†æœ¬é¡µé¢éƒ¨ç½²åˆ° <strong>GitHub Pages</strong>ï¼ˆå…è´¹ HTTPS ç½‘ç«™ï¼‰ã€‚</p>
        <p>âŒ æœ¬åœ°åŒå‡»æ‰“å¼€ï¼ˆfile://ï¼‰æ—¶ï¼Œéƒ¨åˆ†æ•°æ®å¯èƒ½å› å®‰å…¨é™åˆ¶æ— æ³•åŠ è½½ã€‚</p>
        <p>ğŸ”— æ•™ç¨‹ï¼š<a href="https://pages.github.com/" target="_blank">https://pages.github.com/</a></p>
      </div>
    </div>

    <div class="panel">
      <div class="panel-title">ğŸ” å½“å‰çŠ¶æ€åˆ†æ</div>
      <div class="logic-item">
        <span class="logic-label-inline">åŸºé‡‘å‡€å€¼ï¼š</span>
        <span class="logic-status-inline" id="logic-fund">â€”</span>
      </div>
      <div class="logic-item">
        <span class="logic-label-inline">åˆ›ä¸šæ¿æŒ‡ï¼š</span>
        <span class="logic-status-inline" id="logic-cyb">â€”</span>
      </div>
      <div class="logic-item">
        <span class="logic-label-inline">æ–°èƒ½æºæŒ‡æ•°ï¼š</span>
        <span class="logic-status-inline" id="logic-ne">â€”</span>
      </div>
      <div class="logic-item">
        <span class="logic-label-inline">æˆäº¤é‡ä¿¡å·ï¼š</span>
        <span class="logic-status-inline" id="logic-volume">â€”</span>
      </div>
      <div class="logic-item">
        <span class="logic-label-inline">ğŸ“ˆ è¶‹åŠ¿å¥åº·åº¦ï¼š</span>
        <span class="logic-status-inline" id="logic-trend">â€”</span>
      </div>
    </div>
  </div>

  <div class="bottom-row">
    <div class="advice-panel">
      <div class="advice-title">ğŸ“Œ ç»¼åˆæ“ä½œå»ºè®®</div>
      <div class="final-advice" id="final-advice">ç­‰å¾…æ•°æ®åŠ è½½...</div>
    </div>
  </div>

  <div class="update-time" id="update-time">æœ€è¿‘æ›´æ–°ï¼šâ€”</div>

  <script>
    const THRESHOLDS = {
      fundWarn: 2.30,
      fundDanger: 2.45,
      cybWarn: 2700,
      cybDanger: 2850,
      neWarn: 4500,
      neDanger: 4800,
      volumeHigh: 750,
      volumeLow: 400
    };
    const TREND_RULES = {
      cybBreak: 2500,
      neBreak: 4000,
      volumeDry: 300
    };

    let fund = null, cyb = null, ne = null, volume = null;

    function markError(id, msg) {
      document.getElementById(id).textContent = msg;
      document.getElementById(id).className = "data-tip tip-error";
    }

    function updateUI() {
      const allLoaded = (fund !== null && cyb !== null && ne !== null && volume !== null);

      // æ›´æ–°æ•°æ®æ˜¾ç¤º
      if (fund !== null) document.getElementById('fund-value').textContent = fund.toFixed(4);
      else { document.getElementById('fund-value').textContent = 'â€”'; markError('fund-tip', 'âš ï¸ åŠ è½½å¤±è´¥'); }

      if (cyb !== null) document.getElementById('cyb-value').textContent = Math.round(cyb);
      else { document.getElementById('cyb-value').textContent = 'â€”'; markError('cyb-tip', 'âš ï¸ åŠ è½½å¤±è´¥'); }

      if (ne !== null) document.getElementById('ne-value').textContent = Math.round(ne);
      else { document.getElementById('ne-value').textContent = 'â€”'; markError('ne-tip', 'âš ï¸ åŠ è½½å¤±è´¥'); }

      if (volume !== null) document.getElementById('ne-volume').textContent = volume.toFixed(0);
      else { document.getElementById('ne-volume').textContent = 'â€”'; markError('volume-tip', 'âš ï¸ åŠ è½½å¤±è´¥'); }

      if (allLoaded) {
        // === çŠ¶æ€åˆ†æé€»è¾‘ï¼ˆç•¥ï¼ŒåŒå‰ï¼‰===
        const setStatus = (id, html) => document.getElementById(id).innerHTML = html;
        
        setStatus('logic-fund', fund >= THRESHOLDS.fundDanger 
          ? `<span style="color:#dc2626">${fund.toFixed(4)} â‰¥ ${THRESHOLDS.fundDanger}</span>`
          : fund >= THRESHOLDS.fundWarn 
            ? `<span style="color:#d97706">${fund.toFixed(4)} â‰¥ ${THRESHOLDS.fundWarn}</span>`
            : `<span style="color:#16a34a">${fund.toFixed(4)} &lt; ${THRESHOLDS.fundWarn}</span>`
        );

        const setIndexStatus = (id, val, warn, danger) => {
          const v = Math.round(val);
          setStatus(id, val >= danger 
            ? `<span style="color:#dc2626">${v} â‰¥ ${danger}</span>`
            : val >= warn 
              ? `<span style="color:#d97706">${v} â‰¥ ${warn}</span>`
              : `<span style="color:#16a34a">${v} &lt; ${warn}</span>`
          );
        };
        setIndexStatus('logic-cyb', cyb, THRESHOLDS.cybWarn, THRESHOLDS.cybDanger);
        setIndexStatus('logic-ne', ne, THRESHOLDS.neWarn, THRESHOLDS.neDanger);

        if (volume > THRESHOLDS.volumeHigh) {
          setStatus('logic-volume', `<span style="color:#dc2626">${volume.toFixed(0)}äº¿ï¼ˆå·¨é‡ï¼‰</span>`);
        } else if (volume < THRESHOLDS.volumeLow) {
          setStatus('logic-volume', `<span style="color:#16a34a">${volume.toFixed(0)}äº¿ï¼ˆåœ°é‡ï¼‰</span>`);
        } else {
          setStatus('logic-volume', `${volume.toFixed(0)}äº¿å…ƒ`);
        }

        const issues = [];
        if (cyb < TREND_RULES.cybBreak) issues.push("åˆ›ä¸šæ¿<2500");
        if (ne < TREND_RULES.neBreak) issues.push("æ–°èƒ½æº<4000");
        if (volume < TREND_RULES.volumeDry) issues.push("æˆäº¤åœ°é‡");
        const trendHealthy = issues.length === 0;
        setStatus('logic-trend', trendHealthy 
          ? `<span style="color:#16a34a">âœ… è¶‹åŠ¿å¥åº·</span>`
          : `<span style="color:#dc2626">âš ï¸ è¶‹åŠ¿é£é™©ï¼š${issues.join("ï¼›")}</span>`
        );

        // === å»ºè®®ç”Ÿæˆï¼ˆç•¥ï¼‰===
        let advice = "ğŸŸ¡ æŒæœ‰è§‚æœ›", adviceClass = "background:#fef3c7;color:#92400e;";
        const inWarning = (fund >= THRESHOLDS.fundWarn || cyb >= THRESHOLDS.cybWarn || ne >= THRESHOLDS.neWarn);
        const inDanger = (fund >= THRESHOLDS.fundDanger || cyb >= THRESHOLDS.cybDanger || ne >= THRESHOLDS.neDanger);
        const trendBroken = !trendHealthy;

        if (trendBroken) {
          advice = "ğŸ”´ å»ºè®®å‡ä»“è‡³åº•ä»“ï¼ˆè¶‹åŠ¿è½¬å¼±ï¼‰";
        } else if (inDanger) {
          advice = "ğŸ”´ å»ºè®®å†å‡1/3ï¼Œä¿ç•™åº•ä»“";
        } else if (inWarning) {
          if (ne >= THRESHOLDS.neWarn && volume > THRESHOLDS.volumeHigh) {
            advice = "ğŸ”´ å»ºè®®å†å‡1/3ï¼ˆæ”¾é‡æ»æ¶¨ï¼‰";
          } else if (ne >= THRESHOLDS.neWarn && volume < THRESHOLDS.volumeLow) {
            advice = "ğŸŸ¡ æš‚ç¼“æ“ä½œï¼Œè§‚å¯ŸæŒç»­æ€§";
          } else {
            advice = "ğŸŸ¢ å»ºè®®å‡æŒ1/3ä»“ä½";
            adviceClass = "background:#dcfce7;color:#166534;";
          }
        }
        document.getElementById('final-advice').innerHTML = advice;
        document.getElementById('final-advice').style.cssText = `font-size:1.2em;font-weight:700;padding:14px 16px;border-radius:12px;line-height:1.4;${adviceClass}`;

      } else {
        ['logic-fund','logic-cyb','logic-ne','logic-volume','logic-trend'].forEach(id => {
          document.getElementById(id).textContent = 'â€”';
        });
        document.getElementById('final-advice').textContent = 'âŒ æ— æ³•ç”Ÿæˆå»ºè®®ï¼šæ•°æ®ç¼ºå¤±';
        document.getElementById('final-advice').style.cssText = 'font-size:1.2em;font-weight:700;padding:14px 16px;border-radius:12px;line-height:1.4;background:#fee2e2;color:#b91c1c;';
      }

      const now = new Date();
      document.getElementById('update-time').textContent = 
        `æœ€è¿‘æ›´æ–°ï¼š${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
    }

    // === æ•°æ®åŠ è½½ ===
    // 1. åŸºé‡‘å‡€å€¼ï¼ˆå¤©å¤©åŸºé‡‘ï¼‰
    setTimeout(() => {
      const fs = document.createElement('script');
      fs.src = `https://fundgz.1234567.com.cn/js/001158.js?rt=${Date.now()}`;
      window.jsonpgz = function(data) {
        if (data?.dwjz) fund = parseFloat(data.dwjz);
        updateUI();
      };
      fs.onerror = () => { fund = null; updateUI(); };
      document.head.appendChild(fs);
    }, 300);

    // 2. åˆ›ä¸šæ¿ + æ–°èƒ½æºæŒ‡æ•°ï¼ˆç½‘æ˜“è´¢ç»ï¼‰
    function loadFrom163() {
      const codes = ['000399006', '100399808']; // ç½‘æ˜“ç¼–ç ï¼š0+æ·±äº¤æ‰€+6ä½ä»£ç 
      let count = 0;
      const total = codes.length;

      codes.forEach((code, i) => {
        const script = document.createElement('script');
        const cbName = `handle163_${i}`;
        script.src = `https://api.money.126.net/data/feed/${code},money.api?callback=${cbName}&_=${Date.now()}`;

        window[cbName] = function(data) {
          try {
            const price = data[code]?.price;
            if (price && !isNaN(price)) {
              if (code === '000399006') cyb = price;
              else ne = price;
            }
          } catch (e) {}
          cleanup();
        };

        script.onerror = () => { cleanup(); };

        document.head.appendChild(script);

        function cleanup() {
          delete window[cbName];
          const el = document.querySelector(`script[src*="${code}"]`);
          if (el) document.head.removeChild(el);
          count++;
          if (count === total) loadVolume();
        }
      });
    }

    // 3. æˆäº¤é¢ï¼ˆä¸œæ–¹è´¢å¯Œï¼Œé€šè¿‡ f6 å­—æ®µï¼šæˆäº¤é¢ï¼ˆå…ƒï¼‰ï¼‰
    function loadVolume() {
      const script = document.createElement('script');
      script.src = `https://push2.eastmoney.com/api/qt/ulist/get?secids=0.399808&fields=f6&cb=handleVol&_=${Date.now()}`;
      
      window.handleVol = function(data) {
        try {
          if (data?.data?.diff?.[0]?.f6) {
            const amount = data.data.diff[0].f6; // å•ä½ï¼šå…ƒ
            volume = amount / 1e8; // è½¬ä¸ºäº¿å…ƒ
          }
        } catch (e) {}
        cleanup();
      };

      script.onerror = () => { cleanup(); };
      document.head.appendChild(script);

      function cleanup() {
        delete window.handleVol;
        const el = document.querySelector(`script[src*="399808"]`);
        if (el) document.head.removeChild(el);
        updateUI();
      }
    }

    // å¯åŠ¨åŠ è½½
    loadFrom163();

    // è¶…æ—¶ä¿æŠ¤
    setTimeout(() => {
      [fund, cyb, ne, volume].forEach((v, i, arr) => {
        if (v === null) {
          // ä¿æŒ nullï¼Œå·²åœ¨ updateUI ä¸­å¤„ç†
        }
      });
      updateUI();
    }, 6000);
  </script>
</body>
</html>